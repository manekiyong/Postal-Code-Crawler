# Postal Code Crawler
 
## Description
This repository is to retrieve Postal Code & Coordinates information of addresses, based on [Data.gov.sg's Resale Flat Prices](https://data.gov.sg/dataset/resale-flat-prices) dataset, from OneMap API. <br/><br/>
For example, given address __105 Potong Pasir Ave 1__, a request will be made to `https://developers.onemap.sg/commonapi/search?searchVal=105%20POTONG%20PASIR%20AVE%201&returnGeom=Y&getAddrDetails=Y&pageNum=1`, and information will be extracted and parsed into:
```
{
  "105%20POTONG%20PASIR%20AVE%201": {
    "Longitude": "103.868696835165",
    "Latitude": "1.33442373227683",
    "Postal Code": "350105"
  }
}
```


## Usage
Code is tested on Python 3.7.1. Other dependencies are stated in `requirements.txt`. Download the Resale Flat Prices dataset and save it in `.csv` format prior usage. 
#### <u>InitialCrawl.py</u>
![InitialCrawlPreview](/Screenshot/InitialCrawl.png "Initial Crawl Preview")<br>
This `.py` script is used to generate the postal code & coordinates from the first Resale Flat Price `.csv` file. <br/><br/>
Run by executing `python InitialCrawl.py` on your python environment. A simple menu will guide you through the input of files. 
* __Input__ (Files __must__ be in the same folder as `InitialCrawl.py`)
    * Resale flat price `.csv` file (Similar format to that of `ResalePriceDemo.csv`)
* __Output__
    * Address Map `.json` file (Example shown in `Pre-crawled/addressmap.json`, for future crawling use)
    * Address Map `.csv` file (Example shown in `Pre-crawled/addressmap.csv`, for immediate usage)
    * Resale flat price `.csv` file with coordinates & postal code appended.
        * Output file name will be input file name + `-labeled` behind, e.g. ResalePriceDemo-labeled.csv
        * Entries without Postal Code found will be dropped.
    
#### <u>SubsequentCrawl.py</u>
![Subsequent Crawl Preview](/Screenshot/SubsequentCrawl.png "Subsequent Crawl Preview")<br>
This `.py` takes in 2 files; an unlabeled Resale Flat Price `.csv` file, and an Address Mapping `.json` file. If the postal code & coordinates of an address is found in the `.json` file, then it will be retrieved from there, otherwise, API calls to OneMap will be made to retrieve the missing postal code & coordinates. <br/><br/>
Run by executing `python SubsequentCrawl.py` on your python environment. A simple menu will guide you through the input of files. 
* __Input__ (Files __must__ be in the same folder as `SubsequentCrawl.py`)
    * Resale flat price `.csv` file (Similar format to that of `ResalePriceDemo.csv`)
    * Address Mapping `.json` file (Similar format to that of `Pre-crawled/addressmap.json`)
* __Output__
    * Address Map `.json` file (Example shown in `Pre-crawled/addressmap.json`, for future crawling use)
    * Address Map `.csv` file (Example shown in `Pre-crawled/addressmap.csv`, for immediate usage)
    * Resale flat price `.csv` file with coordinates & postal code appended.
        * Output file name will be input file name + `-labeled` behind, e.g. `ResalePriceDemo-labeled.csv`
        * Entries without Postal Code found will be dropped.
        
        
## Pre-crawled dataset
* 9075 Address-Postal Code Mapping entries
* Crawled on 20 Jul 2021
* Generated by running `InitialCrawl.py` on `resale-flat-prices-based-on-registration-date-from-jan-2017-onwards.csv` only.

## Limitations
Note that OneMap API has a [limit of 250 calls per minute](https://www.onemap.gov.sg/docs/#introduction); thus, there is a 245ms delay between each requests (Slightly above 60s/250=240ms). 

